"use strict";(self.webpackChunkAI_things=self.webpackChunkAI_things||[]).push([[549],{8549:(A,g,n)=>{n.r(g),n.d(g,{DrawingPageModule:()=>N});var m=n(6895),S=n(672),l=n(7579),p=n(9300),h=n(8505),f=n(1566),v=n(4482),L=n(5403),P=n(4671);function x(i,r){return i===r}var C=n(3900),$=n(262),b=n(9646),I=n(5963),T=n(5698),w=n(4854),t=n(8256),Z=n(6858),B=n(3066),E=n(4461),j=n(1135);let D=(()=>{class i{constructor(){this.isMicropfoneBusy$=new j.X(!1),this.setMicrophoneBusy=e=>{this.isMicropfoneBusy$.next(e)},this.getMicrophoneBusySubject=()=>this.isMicropfoneBusy$}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var y=n(433);const{Speech:z}=n(6110);let V=(()=>{class i{constructor(e,s,o){this.promptService=e,this.showLoadingService=s,this.microphoneBusyService=o,this.speech=new z("en"),this.isPassive=!1,this.isLoading$=this.showLoadingService.getLoadingVisibility(),this.isloading=!1}ngOnInit(){this.subscription=this.isLoading$.subscribe({next:e=>this.isloading=e})}listen(){!this.isPassive&&!this.isloading&&(this.showLoadingService.show(),this.isPassive=!0,this.microphoneBusyService.setMicrophoneBusy(!0),this.speech.speechRecognition().then(e=>{this.isPassive=!1,this.showLoadingService.hide(),this.microphoneBusyService.setMicrophoneBusy(!1),this.processResult(e)}).catch(e=>{console.log(e),this.isPassive=!1,this.microphoneBusyService.setMicrophoneBusy(!1),this.processResult({phrase:""})}))}processResult(e){this.promptService.setPrompt(e.phrase)}ngOnDestroy(){this.subscription.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(E.l),t.Y36(B.O),t.Y36(D))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-microphone"]],decls:2,vars:4,consts:[[1,"microphone",3,"pointerdown"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.NdJ("pointerdown",function(){return s.listen()}),t.ALo(1,"async"),t.qZA()),2&e&&t.ekj("passive",s.isPassive||t.lcZ(1,2,s.isLoading$))},dependencies:[m.Ov],styles:[".microphone[_ngcontent-%COMP%]{width:60px;height:60px;background-image:url(microphone.50237fe3391b7488.png);background-size:cover;cursor:pointer;opacity:.5}.microphone[_ngcontent-%COMP%]:hover{opacity:.8}.passive[_ngcontent-%COMP%]{opacity:.2;cursor:auto}.passive[_ngcontent-%COMP%]:hover{opacity:.2}"]}),i})();var F=n(4929);const J=[{path:"",component:(()=>{class i{constructor(e,s,o,a){this.httpService=e,this.showLoadingService=s,this.promptService=o,this.microphoneBusyService=a,this.title=w.NL,this.prompt="",this.lastPrompt="",this.prompt$=this.promptService.getPrompt(),this.alt$=new l.x,this.placeholder="type...",this.src="",this.isVisible=!0,this.isMicrophoneBusy$=this.microphoneBusyService.getMicrophoneBusySubject(),this.isMicrophoneBusy=!1}ngOnInit(){window.scrollTo(0,0),this.listenInput(),this.subscription=this.isMicrophoneBusy$.subscribe(e=>{this.isMicrophoneBusy=e,e&&(this.src="",this.prompt="",this.alt$.next(""))}),this.inputElement=document.querySelector(".prompt-input")}listenInput(){this.prompt$.pipe((0,p.h)(e=>""!==e.trim()&&e.trim()!==this.lastPrompt),(0,h.b)(e=>{this.showLoadingService.hide(),this.isVisible=!0,this.lastPrompt=e.trim(),this.prompt=e,console.log("val:",e)}),function M(i,r=f.z){return(0,v.e)((e,s)=>{let o=null,a=null,c=null;const d=()=>{if(o){o.unsubscribe(),o=null;const u=a;a=null,s.next(u)}};function U(){const u=c+i,O=r.now();if(O<u)return o=this.schedule(void 0,u-O),void s.add(o);d()}e.subscribe((0,L.x)(s,u=>{a=u,c=r.now(),o||(o=r.schedule(U,i),s.add(o))},()=>{d(),s.complete()},void 0,()=>{a=o=null}))})}(1500),function R(i,r=P.y){return i=i??x,(0,v.e)((e,s)=>{let o,a=!0;e.subscribe((0,L.x)(s,c=>{const d=r(c);(a||!i(o,d))&&(a=!1,o=d,s.next(c))}))})}(),(0,h.b)(()=>{this.showLoadingService.show(),this.isVisible=!1,this.inputElement?.blur()}),(0,C.w)(e=>{console.log(e);const s=JSON.stringify({user_app_id:{user_id:"borisdayma",app_id:"generative-art"},inputs:[{data:{text:{raw:e}}}]});return this.httpService.postData(w.h6,s,{headers:{Accept:"application/json",Authorization:"Key "+w.$h}})}),(0,$.K)(e=>(console.log(e),this.showLoadingService.hide(),this.isVisible=!0,this.processData(null,!0),this.listenInput(),(0,b.of)([])))).subscribe({next:e=>{console.log(e),this.isVisible=!0,this.showLoadingService.hide(),this.processData(e)},error:e=>{console.log(e),this.showLoadingService.hide(),this.isVisible=!0,this.processData(null,!0)}})}setPrompt(){this.prompt.trim().length>=3&&setTimeout(()=>{this.promptService.setPrompt(this.prompt),this.alt$.next(this.prompt)},1e3)}processData(e,s=!1){let o=["Error!","Try again!",this.prompt],a=0;if(!s&&e){let c=e?.outputs?.[0]?.data?.image?.base64;c&&(this.src=`data:image/png;base64,${c}`)}else if(s){let c=(0,I.H)(0,2e3).pipe((0,T.q)(o.length),(0,C.w)(()=>(0,b.of)(o[a])),(0,h.b)(()=>a++),(0,h.b)(d=>this.alt$.next(d)),(0,h.b)(()=>{a>=o.length-1&&c.unsubscribe()})).subscribe()}}ngOnDestroy(){this.subscription.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Z.O),t.Y36(B.O),t.Y36(E.l),t.Y36(D))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-drawing-page"]],decls:10,vars:18,consts:[["type","text",1,"prompt-input",3,"ngModel","disabled","placeholder","ngModelChange","input"],[1,"drawing-image",3,"src","alt"]],template:function(e,s){1&e&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"async"),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"input",0),t.NdJ("ngModelChange",function(a){return s.prompt=a})("input",function(){return s.setPrompt()}),t.ALo(5,"async"),t.ALo(6,"translate"),t.qZA(),t._UZ(7,"img",1),t.ALo(8,"async"),t._UZ(9,"app-microphone")),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,8,t.lcZ(3,10,s.title))),t.xp6(3),t.s9C("placeholder",t.lcZ(5,12,t.lcZ(6,14,s.placeholder))),t.Q6J("ngModel",s.prompt)("disabled",s.isMicrophoneBusy),t.xp6(3),t.ekj("invisible",!s.isVisible),t.s9C("src",s.src,t.LSH),t.s9C("alt",t.lcZ(8,16,s.alt$)))},dependencies:[y.Fj,y.JJ,y.On,V,m.Ov,F.X],styles:["[_nghost-%COMP%]{color:#999;font-size:20px;font-family:Segoe Print;display:flex;flex-direction:column;align-items:center;justify-content:space-around;gap:20px}.drawing-image[_ngcontent-%COMP%]{width:300px;height:300px;box-shadow:inset 2px 2px 5px #0003;transition:1.5s;opacity:1}input[_ngcontent-%COMP%]{font-family:Segoe Print;outline:none!important;border:2px solid #090!important;color:#090!important}.invisible[_ngcontent-%COMP%]{opacity:.1}"]}),i})()}];let Y=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[S.Bz.forChild(J),S.Bz]}),i})();var K=n(294);let N=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[m.ez,Y,y.u5,K.I]}),i})()},6110:(A,g,n)=>{n.r(g),n.d(g,{Speech:()=>m});class m{constructor(l="en"){this.lang=l,this.recognition=void 0,this.isStarted=!1,this.listener=void 0,this.soundendListener=void 0,this.soundstartListener=void 0,this.audioendListener=void 0,this.audiostartListener=void 0,this.speechendListener=void 0,this.speechstartListener=void 0,this.nomatchListener=void 0,this.interval=void 0}lookForSoundStart(){return new Promise((l,p)=>{this.soundstartListener=()=>l("ok, sound started"),this.recognition&&this.recognition.addEventListener("speechstart",this.soundstartListener)})}lookForAudioStart(){return new Promise((l,p)=>{this.audiostartListener=()=>l("ok, audio started"),this.recognition&&this.recognition.addEventListener("audiostart",this.audiostartListener)})}speechRecognition(){return new Promise((l,p)=>{if(!("webkitSpeechRecognition"in window))return p("SpeechRecognition doesn't support");this.recognition=new webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.lang=this.lang,this.recognition.interimResults=!1,this.recognition.maxAlternatives=10,this.recognition.start(),console.log("Ready to receive a command."),this.isStarted=!0,this.interval=setInterval(()=>{if(this.isStarted)return clearInterval(this.interval),this.stopRecognition(),p("It took too long time!Try again!")},1e4),this.listener=h=>{this.isStarted=!1,clearInterval(this.interval);const f=h.results,v=h.results[0][0].transcript,L=h.results[0][0].confidence;return Array.from(f).forEach(M=>{Array.from(M).forEach(P=>console.log(P))}),console.dir(`Results: ${h.results}`),console.log(`Result received: ${v}`),this.recognition.stop(),l({phrase:v,confidence:L,results:f})},this.nomatchListener=()=>p("speech not recognized! Try again!"),this.soundendListener=()=>{console.log("soundend")},this.audioendListener=()=>{console.log("audioend")},this.speechstartListener=()=>{console.log("speechstart")},this.speechendListener=()=>{console.log("speechdend")},this.recognition.addEventListener("result",this.listener),this.recognition.addEventListener("nomatch",this.nomatchListener,{once:!0}),this.recognition.addEventListener("soundend",this.soundendListener),this.recognition.addEventListener("soundstart",this.soundstartListener),this.recognition.addEventListener("audioend",this.audioendListener),this.recognition.addEventListener("audiostart",this.audiostartListener),this.recognition.addEventListener("speechend",this.speechendListener),this.recognition.addEventListener("speechstart",this.speechstartListener),this.recognition.onerror=h=>(this.isStarted=!1,clearInterval(this.interval),console.log("error:",h.error),this.recognition.stop(),p(h.error))})}stopRecognition(){this.recognition&&(this.isStarted=!1,clearInterval(this.interval),this.recognition.stop(),console.log("Recognition stopped!"),this.removeListeners())}abortRecognition(){this.recognition&&(this.isStarted=!1,clearInterval(this.interval),this.recognition.abort(),console.log("Recognition aborted!"),this.removeListeners())}removeListeners(){this.recognition.removeEventListener("result",this.listener),this.recognition.removeEventListener("nomatch",this.nomatchListener,{once:!0}),this.recognition.removeEventListener("soundend",this.soundendListener),this.recognition.removeEventListener("soundstart",this.soundstartListener),this.recognition.removeEventListener("audioend",this.audioendListener),this.recognition.removeEventListener("audiostart",this.audiostartListener),this.recognition.removeEventListener("speechend",this.speechendListener),this.recognition.removeEventListener("speechstart",this.speechstartListener)}}}}]);